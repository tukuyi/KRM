SZR_chat_content_check = {
	ROOT = {
		SZR_chat_close = yes
		if = {
			limit = {
				is_state = 613
			}
			set_variable = { ROOT.SZR_current_chat_content = token:demo }
		}
		if = {
			limit = {
				is_state = 650
				ROOT = {
					has_country_flag = SZC_SZR_kmd_c1
				}
			}
			set_variable = { ROOT.SZR_current_chat_content = token:kmd_c1 }
			scoped_play_song = "Suzerain_-_14_Pinnacle"
			clr_country_flag = SZC_SZR_kmd_c1
		}
		if = {
			limit = {
				is_state = 650
				ROOT = {
					has_country_flag = SZC_SZR_kmd_c2
				}
			}
			set_variable = { ROOT.SZR_current_chat_content = token:kmd_c2 }
			scoped_play_song = "Suzerain_-_18_Summary"
			clr_country_flag = SZC_SZR_kmd_c2
		}
		SZR_all_setup = yes
		SZR_chat_remove_first = yes
		add_to_array = { ROOT.SZR_current_chat_messages = 1 }
		ROOT = { set_country_flag = SZR_chat_gui_visible }
	}
}

SZR_all_setup = {
	SZR_chat_setup_first = yes
	SZR_chat_generic_setup = yes
}

SZR_option_setup_debug = {
	add_to_array = { ROOT.SZR_chat_options = 1 }
	add_to_array = { ROOT.SZR_chat_options = 2 }
	add_to_array = { ROOT.SZR_chat_options = 3 }
	add_to_array = { ROOT.SZR_chat_options = 4 }
}


SZR_chat_setup_first = {
	add_to_array = { ROOT.SZR_current_chat_messages = 9998 }
	add_to_array = { ROOT.SZR_current_chat_messages = 9998 }
	add_to_array = { ROOT.SZR_current_chat_messages = 9998 }
	add_to_array = { ROOT.SZR_current_chat_messages = 9998 }
	add_to_array = { ROOT.SZR_current_chat_messages = 9998 }
	add_to_array = { ROOT.SZR_current_chat_messages = 9998 }
	add_to_array = { ROOT.SZR_current_chat_messages = 9998 }
	add_to_array = { ROOT.SZR_current_chat_messages = 9998 }
	add_to_array = { ROOT.SZR_current_chat_messages = 9998 }
	add_to_array = { ROOT.SZR_current_chat_messages = 9998 }
	add_to_array = { ROOT.SZR_current_chat_messages = 9998 }
	add_to_array = { ROOT.SZR_current_chat_messages = 9998 }
	add_to_array = { ROOT.SZR_chat_speaking_bois = 9999 }
	add_to_array = { ROOT.SZR_chat_speaking_bois = 9999 }
	add_to_array = { ROOT.SZR_chat_speaking_bois = 9999 }
	add_to_array = { ROOT.SZR_chat_speaking_bois = 9999 }
}

SZR_chat_close = {
	clear_variable = ROOT.SZR_current_chat_content
	clear_array = ROOT.SZR_current_chat_messages
	clear_array = ROOT.SZR_chat_speaking_bois
	clear_array = ROOT.SZR_chat_options
	clear_array = ROOT.SZR_chat_names
	clear_array = ROOT.SZR_special_transfers
	clear_array = ROOT.SZR_portraits_local
	clear_array = ROOT.SZR_END_msgs
	clr_country_flag = SZR_chat_gui_visible
}

SZR_chat_remove_first = {
	remove_from_array = { 
		array = ROOT.SZR_current_chat_messages
		index = 0 
	}
}
SZR_chat_portrait_remove_first = {
	remove_from_array = { 
		array = ROOT.SZR_chat_speaking_bois
		index = 0 
	}
}
SZR_chat_portrait_add_first = {
	add_to_array = { 
		array = ROOT.SZR_chat_speaking_bois
		index = 0
		value = 9999
	}
}
SZR_chat_portrait_move_last = {
	remove_from_array = { 
		array = ROOT.SZR_chat_speaking_bois
		value = var:temp_add_boi
	}
	add_to_array = { 
		array = ROOT.SZR_chat_speaking_bois
		value = var:temp_add_boi
	}
}
SZR_chat_option_select = {
	clear_array = ROOT.SZR_chat_options
	meta_effect = {
		text = {
			SZR_chat_options_EFFECT_[CONTEXT] = yes
		}
		CONTEXT = "[?ROOT.SZR_current_chat_content.GetTokenKey]"
	}
}

SZR_chat_continue_effect = {
	log = "last_value = [?last_value]"
	SZR_chat_remove_first = yes
	set_temp_variable = { last_value = ROOT.SZR_current_chat_messages^10 }
	SZR_chat_END_check = yes
	SZR_chat_special_transfer_check = yes
	SZR_chat_name_check = yes
	SZR_chat_portrait_check = yes
	SZR_chat_option_check = yes
	log = "msg = [?ROOT.SZR_current_chat_messages^9]"
	log = "msg = [?ROOT.SZR_current_chat_messages^10]"
	log = "msg = [?ROOT.SZR_current_chat_messages^11]"
	log = "last_value = [?last_value]"
	add_to_array = { ROOT.SZR_current_chat_messages = var:last_value }
}
SZR_chat_option_select_generic_effect = {
	SZR_chat_remove_first = yes
	SZR_chat_name_check = yes
	SZR_chat_portrait_check = yes
	SZR_chat_option_check = yes
	add_to_array = { ROOT.SZR_current_chat_messages = var:last_value }
}
SZR_chat_special_transfer_check = {
	if = {
		limit = {
			is_in_array = {
				value = var:last_value
				array = ROOT.SZR_special_transfers
			}
		}
		meta_effect = {
			text = {
				SZR_chat_special_transfer_[CONTEXT] = yes
			}
			CONTEXT = "[?SZR_current_chat_content.GetTokenKey]"
		}
	}
	else = {
		add_to_temp_variable = { last_value = 1 }
		log = "last_value = [?last_value]"
	}
}
SZR_chat_option_check = {
	if = {
		limit = {
			is_in_array = {
				value = var:last_value
				array = ROOT.SZR_chat_options_available
			}
		}
		meta_effect = {
			text = {
				SZR_chat_options_get_[CONTEXT] = yes
			}
			CONTEXT = "[?SZR_current_chat_content.GetTokenKey]"
		}
	}
}
SZR_chat_name_check = {
	if = {
		limit = {
			is_in_array = {
				value = var:last_value
				array = ROOT.SZR_chat_names
			}
		}
		meta_effect = {
			text = {
				SZR_chat_names_get_[CONTEXT] = yes
			}
			CONTEXT = "[?SZR_current_chat_content.GetTokenKey]"
		}
	}
}
SZR_chat_portrait_check = {
	if = {
		limit = {
			is_in_array = {
				value = var:last_value
				array = ROOT.SZR_portraits_local
			}
		}
		meta_effect = {
			text = {
				SZR_chat_portraits_get_[CONTEXT] = yes
				log = "last_value = SZR_chat_portraits_get_[CONTEXT]"
			}
			CONTEXT = "[?SZR_current_chat_content.GetTokenKey]"
		}
	}
}

SZR_chat_END_check = {
	if = {
		limit = {
			is_in_array = {
				value = var:last_value
				array = ROOT.SZR_END_msgs
			}
		}
		SZR_chat_close = yes
	}
	custom_effect_tooltip = SZR_chat_continue_tt
}

SZR_chat_generic_setup = {
	meta_effect = {
		text = {
			SZR_chat_[CONTEXT]_special_transfer_setup = yes
			SZR_chat_[CONTEXT]_option_setup = yes
			SZR_chat_[CONTEXT]_END_setup = yes
			SZR_chat_[CONTEXT]_portraits_setup = yes
			SZR_chat_[CONTEXT]_name_setup = yes
		}
		CONTEXT = "[?SZR_current_chat_content.GetTokenKey]"
	}
}